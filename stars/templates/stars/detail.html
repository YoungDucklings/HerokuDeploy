{% extends 'base.html' %}

{% block body %}
{% include '_nav.html' %}
<div class='container my-3'>
  <div class="row">
    <div class="card card-profile mx-auto my-3 col-4">
      {% if star.profileimg_set.all %}
      <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">

          <div class="carousel-item active">
            <img class="card-img-top d-block w-100" src="{{ star.profileimg_set.first }}" alt="First slide"
              style="width:300px">
          </div>

          {% for profileimg in star.profileimg_set.all|slice:"1:" %}
          <div class="carousel-item">
            <img class="card-img-top d-block w-100" src="{{ profileimg }}" style="width:300px">
          </div>
          {% endfor %}
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      {% endif %}

      <div class="card-body">
        <h5 class="card-title">{{ star }}
          {% if user in star.user_set.all %}
          <button id="like-button" class="btn btn-danger btn-link btn-fab btn-fab-mini btn-round">
            <i  data-id="{{ star.pk }}" class="material-icons">favorite</i></button>
          {% else %}
          <button id="like-button" class="btn btn-danger btn-link btn-fab btn-fab-mini btn-round">
            <i data-id="{{ star.pk }}" 
            class="material-icons" 
            style="color: transparent;
            -webkit-text-stroke-width: 1px;
            -webkit-text-stroke-color: red;">favorite</i></button>
          {% endif %}
          <span id="like-count">{{ star.user_set.count }} likes</span> 
        </h5>
        <p class="card-text">
          
          
          {% if star.birthday|date:'Y-m-d' != '1111-11-11' %}
          birthday : {{ star.birthday }}
          {% endif %}
          <br />
          {% if star.deathday|date:'Y-m-d' != '1111-11-11' %}
          deathday : {{ star.deathday }}
          {% endif %}
          <br />
          {% if star.department != '' %}
          department : {{ star.department }}
          {% endif %}
          <br />
          {% if star.biography != '' %}
          biography : {{ star.biography }}
          {% endif %}
          <br />
          {% if star.homepage != '' %}
          homepage : <a href="{{ star.homepage }}" target="_blank">{{ star.homepage }}</a>
          {% endif %}

        </p>
      </div>
    </div>
  </div>


  <h2 class="title">Gallery</h2>
  <div>
    {% if star.tagedimg_set.all %}
    <h3>Tagged Image</h3>
    <div style="width: auto; overflow-x: scroll; white-space: nowrap;">
      {% for tagedimg in star.tagedimg_set.all %}
      <div class='my-3'>
        <li>{{ tagedimg.movie }}<br>
          <img src="{{ tagedimg.posters }}" alt="{{ star.name }}" width="200px">
          <img src="{{ tagedimg.backdrops }}" alt="{{ star.name }}" height="300px">
        </li>
      </div>
      {% endfor %}
      {% endif %}

    </div>
  </div>

  <div>
    {% if posters %}
    <h3 class="title">Movies</h3>
    <div class="row">
      {% for poster in posters %}
      <div class="col-3">
        <a href="{% url 'movies:detail' poster.movie_id %}"><img src="{{ poster.url }}" alt="{{ star.name }}"
            width="200px"></a>
        <p></p>{{ poster.movie }}</p>
        <div><span style="color: goldenrod;">â˜…</span><span>{{ poster.movie.vote_average }}</span></div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

  </div>
</div>
<script>
  const likeButton = document.querySelector('#like-button')
  const likeCount = document.querySelector('#like-count')
  likeButton.addEventListener('click', e => {
    const starId = e.target.dataset.id
    axios.get(`/stars/${starId}/like/`)
      .then(res => {
        if (res.data.liked) {
          // unlike button
          e.target.removeAttribute("style")
        } else {
          // like button
          e.target.setAttribute(
          "style", "color: transparent; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: red;");
        }
        likeCount.innerText = res.data.count
      })
  })
</script>
{% endblock %}