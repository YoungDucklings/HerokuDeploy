{% extends 'base.html' %}
{% load static %}
{% load bootstrap4 %}


{% block body %}

{% include '_nav.html' %}
<style>
  .arraycontainer::-webkit-scrollbar {
    display: none;
  }
  
  /* Hide scrollbar for IE and Edge */
  .arraycontainer {
    -ms-overflow-style: none;
    width: auto; overflow-x: auto; white-space: nowrap;
    background-color: #fff;
    background-clip: border-box;
    border: 1px solid rgba(0, 0, 0, 0.12);
    border-radius: 0.25rem;
    width:80vw; margin:auto;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.3), 0 3px 10px 0 rgba(0, 0, 0, 0.1);
    margin-top: 5vh;
  }

  .content {
  position: absolute;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  color: #f1f1f1;
  width: 100%;
  padding: 0px 10px;
}

h5 {
  white-space:normal;
}
</style>



  <div class="card text-center" style="width:80vw; margin:auto;">
    <div class="card-body">
      <h4 class="card-title">Pick your stars and movies!</h4>
      <p class="card-text">
        Get some your favorite to start our Service</p>
      <div class="progress-container progress-warning">
        <div class="progress mt-2">
          <div id="percentage" class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="45" aria-valuemin="0"
            aria-valuemax="100" style="width: 0%;">
          </div>
        </div>
      </div>
      <a href="{% url 'info:rec' %}" class="btn btn-primary">submit</a>
    </div>
  </div>



  <div class="arraycontainer">
    <div style="display:inline-flex; align-items:center;">
    {% for pick in pickset %}
      <div class="card my-3 mx-3 bg-dark text-white" style="width:20vw; min-width:200px; margin: auto;">
        {% if pick.name %}
        {% if pick.profileimg_set.all %}
        <img src="{{ pick.profileimg_set.first }}" class="card-img rounded mx-auto" alt="{{ pick.name }}">
        {% else %}
        <img src="{% static 'img/default.png' %}" class="card-img rounded mx-auto" alt="{{ pick.name }}">
        {% endif %}
        <div class="content">
          <h5 class="card-title">{{ pick.name }}</h5>
          <p class="card-text">
            {% if user in star.user_set.all %}
            <button id="like-button" class="btn btn-danger btn-link btn-fab btn-fab-mini btn-round">
              <i data-id="{{ pick.pk }}" class="material-icons">favorite</i></button>
            {% else %}
            <button id="like-button" class="btn btn-danger btn-link btn-fab btn-fab-mini btn-round">
              <i data-id="{{ pick.pk }}" class="material-icons" style="color: transparent;
              -webkit-text-stroke-width: 1px;
              -webkit-text-stroke-color: red;">favorite</i></button>
            {% endif %}
          </p>
        </div>
        {% else %}
        {% if pick.poster_set.all %}
        <img src="{{ pick.poster_set.first }}" class="card-img rounded mx-auto" alt="{{ pick.title }}">
        {% else %}
        <img src="{% static 'img/default.png' %}" class="card-img rounded mx-auto" alt="{{ pick.title }}">
        {% endif %}
        <div class="content">
          <h5 class="card-title">{{ pick.title }}</h5>
          <p class="card-text">
            <div data-id="{{ pick.pk }}" id="score-box">
              {% for i in '12345'|make_list %}
              {% if score >= forloop.counter %}
              <i id="{{ forloop.counter }}" class="fa fa-star" aria-hidden="true"
                onclick="mouseClick({{ forloop.counter }})" style="color: gold; text-shadow: 3px 5px grey"></i>
              {% else %}
              <i id="{{ pick.pk }}{{ forloop.counter }}" class="fa fa-star" aria-hidden="true"
                onclick="mouseClick({{ forloop.counter }}, {{ pick.pk }})"></i>
              {% endif %}
              {% endfor %}
            </div>
          </p>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>



<script>
  const likeButton = document.querySelectorAll('#like-button')
  let percentage = document.getElementById('percentage')
  let selectNum = 0
  const selected = new Set

  // percentage.style.width

  for (let i = 0; i < likeButton.length; i++) {
    likeButton[i].addEventListener('click', e => {
      const starId = e.target.dataset.id
      axios.get(`/stars/${starId}/like/`)
        .then(res => {
          if (res.data.liked) {
            // unlike button
            if (!(selected.has(starId))) {
              e.target.removeAttribute("style")
              selectNum++
              selected.add(starId)
              percentage.setAttribute("style", `width:${selectNum/20 * 100}%`)
            }
          } else {
            // like button
            e.target.setAttribute(
              "style", "color: transparent; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: red;");
            selectNum--
            selected.delete(starId)
            percentage.setAttribute("style", `width:${selectNum/20 * 100}%`)
          }
        })
    })
  }

  function mouseClick(n, movie_id) {
    if (!(selected.has(movie_id))) {
      selectNum++
      selected.add(movie_id)
      percentage.setAttribute("style", `width:${selectNum/20 * 100}%`)
    }
    for (let i = n; i > 0; i--) {
      // console.log(i)
      document.getElementById(String(movie_id)+String(i)).setAttribute(
        "style", "color: gold; text-shadow: 3px 5px grey");
    }
    for (let i = n + 1; i < 6; i++) {
      // console.log(i)
      document.getElementById(String(movie_id)+String(i)).removeAttribute(
        "style");
    }
    axios.get(`/movies/${movie_id}/${n}/rate/`)
  }

</script>
{% endblock %}