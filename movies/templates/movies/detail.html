{% extends 'base.html' %}
{% load bootstrap4 %}

{% block body %}
{% include '_nav.html' %}
<style>
.arraycontainer::-webkit-scrollbar {
  display: none;
}

/* Hide scrollbar for IE and Edge */
.arraycontainer {
  -ms-overflow-style: none;
  width: auto; overflow-x: auto; white-space: nowrap;
}
</style>
<div class="row container">


</div>

<div id="yet" class="my-3">
  <div id="content-container" class="container">
    <div class="card bg-dark text-white">

      <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
  
          <div class="carousel-item active">
            <img class="card-img d-block w-100" src="{{ backdrops.first }}" alt="Card image">
          </div>
  
          {% for backdrop in backdrops|slice:"1:" %}
          <div class="carousel-item">
              <img class="card-img d-block w-100" src="{{ backdrop }}" alt="Card image">
          </div>
          {% endfor %}
        
        </div>
      </div>

      <div class="card-img-overlay">
        <h2 class="card-title">{{ movie.original_title }}</h2>
        <p class="card-text">
          <p class="card-text">
            <div data-id="{{ movie.pk }}" id="score-box">
              {% for i in '12345'|make_list %}
              {% if score >= forloop.counter %}
              <i id="{{ forloop.counter }}" class="fa fa-star" aria-hidden="true"
                onclick="mouseClick({{ forloop.counter }})"
                style="color: gold; text-shadow: 3px 5px grey"></i>
              {% else %}
              <i id="{{ forloop.counter }}" class="fa fa-star" aria-hidden="true"
                onclick="mouseClick({{ forloop.counter }})"
                ></i>
              {% endif %}
              {% endfor %}
            </div>
          </p>
          <p class="card-text" style="width:300px">{{ movie.overview }}</p>
          <p class="card-text">
            vote average: {{ movie.vote_average }} <br />

            geres :
            {% for genre in movie.genres.all %}
            {{ genre }} |
            {% endfor %}<br />
            adult : {{ movie.adult }}<br/>
            release date : {{ movie.release_date }}<br />
            runtime : {{ movie.runtime }}<br />
            status : {{ movie.status }}</p>
      </div>
    </div>

    <div class="arraycontainer">
      <div class="d-inline-flex">
          {% for cast in movie.cast_set.all %}
          <a href="{% url 'stars:detail' cast.star.pk %}">
          <div class="card bg-dark text-white mx-2" style="width:200px"
          onmouseout="hideCastInfo({{forloop.counter}})" onmouseover="castInfo({{forloop.counter}})">
            <img class="card-img" src="{{ cast.star.profileimg_set.first }}" alt="Card image">
            <div class="card-img-overlay" style="display:none" id="cast{{forloop.counter}}">
              {% if cast.character %}
              <h4 class="card-title">{{ cast.star }}</h4>
              <p class="card-text">{{ cast.character }}</p>
              {% else %}
              <h4 class="card-title">{{ cast.star }}</h4>
              <p class="card-text">Director</p>
              {% endif %}
            </div>
          </div>
          {% endfor %}
          </a>
      </div>
    </div>

    

    <h2 class="title">Gallery</h2>
    {% if posters %}
    <h3>Poster</h3>
    <div class="arraycontainer">
      {% for poster in posters %}
      <img src="{{ poster }}" width="30%">
      {% endfor %}
      {% endif %}
    </div>

    {% if videos %}
    <h3>Video</h3>
    <div id="carouselExampleControls2" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">

        <div class="carousel-item active">
          <iframe width="560" height="315" src="{{ videos.last }}" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

        </div>
        {% for video in videos|slice:"1:" %}
        <div class="carousel-item">
          <iframe width="560" height="315" src="{{ video }}" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        {% endfor %}
      </div>
      <a class="carousel-control-prev" href="#carouselExampleControls2" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleControls2" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
    {% endif %}

    <h2 class="title">Comment</h2>
    {% if request.user.is_authenticated %}
    <form action="{% url 'movies:comment_create' movie.id %}" method="POST">
      {% csrf_token %}
      {% bootstrap_form comment_form %}
      <button class="btn btn-primary" type="submit">save</button>
    </form>
    {% endif %}
    {% if comments %}
    <div class="card">
      <ul class="list-group list-group-flush">
        {% for comment in comments %}
        <li class="list-group-item">
          <p class="d-inline">{{ comment }} | <a
              href="{% url 'accounts:detail' comment.stalker.pk %}">{{ comment.stalker }}</a></p>
          {% if request.user == comment.stalker %}
          <form class="d-inline" action="{% url 'movies:comment_delete' movie.pk comment.pk %}" method="POST">
            {% csrf_token %}
            <button class="btn btn-primary btn-sm">delete</button>
          </form>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
  <script>

    function mouseClick(n) {
      for (let i = n; i > 0; i--) {
        console.log(i)
        document.getElementById(i).setAttribute(
          "style", "color: gold; text-shadow: 3px 5px grey");
      }
      for (let i = n+1; i<6; i++) {
        console.log(i)
          document.getElementById(i).removeAttribute(
            "style");}
      movie_id = document.querySelector('#score-box').dataset.id
      axios.get(`/movies/${movie_id}/${n}/rate/`)
    }

    function castInfo(n) {
      document.getElementById(`cast${n}`).removeAttribute("style");
    }

    function hideCastInfo(n) {
      document.getElementById(`cast${n}`).setAttribute("style", "display:none");
    }    
    
  </script>
  {% endblock %}